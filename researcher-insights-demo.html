<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AlphaTanks - Researcher Insights Demo</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            min-height: 100vh;
        }

        .main-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
        }

        .header h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .header p {
            font-size: 1.2em;
            margin: 10px 0;
            opacity: 0.9;
        }

        .demo-panel {
            background: rgba(0,0,0,0.4);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .btn.secondary {
            background: linear-gradient(45deg, #74b9ff, #0984e3);
        }

        .btn.success {
            background: linear-gradient(45deg, #00b894, #00a085);
        }

        .simulation-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .team-panel {
            background: rgba(0,0,0,0.2);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid;
        }

        .red-team {
            border-color: #ff6b6b;
        }

        .blue-team {
            border-color: #74b9ff;
        }

        .genome-display {
            font-family: monospace;
            font-size: 12px;
            background: rgba(0,0,0,0.3);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            overflow-x: auto;
        }

        .trait-bar {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }

        .trait-name {
            width: 120px;
            font-size: 11px;
        }

        .trait-value {
            flex: 1;
            height: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin: 0 10px;
            position: relative;
        }

        .trait-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .status-panel {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            line-height: 1.4;
        }

        .log-area {
            background: rgba(0,0,0,0.5);
            padding: 15px;
            border-radius: 8px;
            height: 200px;
            overflow-y: auto;
            font-size: 12px;
            font-family: monospace;
        }

        .log-entry {
            margin: 3px 0;
            padding: 3px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .log-category {
            color: #74b9ff;
            font-weight: bold;
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(0,0,0,0.3);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #00b894;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 5px;
        }

        .insights-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .running {
            animation: pulse 1s infinite;
        }

        .evolution-visualization {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .trait-evolution {
            margin: 15px 0;
        }

        .evolution-chart {
            display: flex;
            align-items: end;
            height: 60px;
            gap: 2px;
            margin: 10px 0;
        }

        .evolution-bar {
            flex: 1;
            background: linear-gradient(to top, #74b9ff, #0984e3);
            min-height: 2px;
            border-radius: 2px 2px 0 0;
            transition: height 0.3s ease;
        }

        .red-bar {
            background: linear-gradient(to top, #ff6b6b, #e55656);
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px;
            font-size: 14px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <h1>üî¨ AlphaTanks Researcher Insights</h1>
            <p>Deep dive into how the ASI-ARCH Researcher module evolves tank AI through genetic algorithms</p>
            <p><strong>üß¨ Red Queen Race Dynamics ‚Ä¢ üéØ Tactical Evolution ‚Ä¢ üìä Real-time Analytics</strong></p>
        </div>

        <div class="insights-toggle">
            <button class="btn secondary" onclick="window.researcherInsights?.toggle()">
                üìà Toggle Insights Dashboard
            </button>
        </div>

        <div class="demo-panel">
            <h2>üéÆ Interactive Evolution Simulation</h2>
            <div class="controls">
                <button class="btn" onclick="startEvolution()">üöÄ Start Evolution</button>
                <button class="btn secondary" onclick="pauseEvolution()">‚è∏Ô∏è Pause</button>
                <button class="btn secondary" onclick="stepEvolution()">‚è≠Ô∏è Step</button>
                <button class="btn success" onclick="resetSimulation()">üîÑ Reset</button>
                <button class="btn secondary" onclick="generateReport()">üìä Generate Report</button>
                <button class="btn secondary" onclick="exportData()">üíæ Export Data</button>
            </div>

            <div class="quick-stats">
                <div class="stat-card">
                    <div class="stat-value" id="generation-count">0</div>
                    <div class="stat-label">Generation</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="mutation-count">0</div>
                    <div class="stat-label">Mutations</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="crossover-count">0</div>
                    <div class="stat-label">Crossovers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="tournament-count">0</div>
                    <div class="stat-label">Tournaments</div>
                </div>
            </div>

            <div class="simulation-area">
                <div class="team-panel red-team">
                    <h3>üî¥ Red Team Evolution</h3>
                    <div id="red-genome-display" class="genome-display">
                        <div class="trait-bar">
                            <span class="trait-name">Aggression:</span>
                            <div class="trait-value"><div class="trait-fill red-bar" style="width: 50%"></div></div>
                            <span>0.50</span>
                        </div>
                        <!-- More traits will be added dynamically -->
                    </div>
                    <div class="status-panel">
                        <strong>Current Strategy:</strong> <span id="red-strategy">Balanced</span><br>
                        <strong>Fitness Trend:</strong> <span id="red-fitness">Stable</span><br>
                        <strong>Diversity:</strong> <span id="red-diversity">Medium</span>
                    </div>
                </div>

                <div class="team-panel blue-team">
                    <h3>üîµ Blue Team Evolution</h3>
                    <div id="blue-genome-display" class="genome-display">
                        <div class="trait-bar">
                            <span class="trait-name">Aggression:</span>
                            <div class="trait-value"><div class="trait-fill" style="width: 50%"></div></div>
                            <span>0.50</span>
                        </div>
                        <!-- More traits will be added dynamically -->
                    </div>
                    <div class="status-panel">
                        <strong>Current Strategy:</strong> <span id="blue-strategy">Balanced</span><br>
                        <strong>Fitness Trend:</strong> <span id="blue-fitness">Stable</span><br>
                        <strong>Diversity:</strong> <span id="blue-diversity">Medium</span>
                    </div>
                </div>
            </div>

            <div class="evolution-visualization">
                <h3>üìà Evolution Trends</h3>
                <div class="trait-evolution">
                    <h4>Aggression Evolution</h4>
                    <div class="evolution-chart" id="aggression-chart"></div>
                </div>
                <div class="trait-evolution">
                    <h4>Tactical Sophistication</h4>
                    <div class="evolution-chart" id="tactics-chart"></div>
                </div>
            </div>

            <div class="log-area" id="demo-logs">
                <div class="log-entry">
                    <span class="log-category">[SYSTEM]</span> Researcher Insights Demo initialized
                </div>
                <div class="log-entry">
                    <span class="log-category">[INFO]</span> Ready to begin evolution simulation
                </div>
            </div>
        </div>

        <div class="footer">
            <p>üß¨ AlphaTanks ASI-ARCH Researcher Insights ‚Ä¢ Built for understanding evolutionary AI dynamics</p>
            <p>This demo showcases the internal workings of the genetic algorithm evolution system</p>
        </div>
    </div>

    <!-- Load the core scripts -->
    <script src="asi-arch-modules.js"></script>
    <script src="evolution-engine.js"></script>
    <script src="researcher-insights.js"></script>
    <script src="enhanced-asi-arch.js"></script>

    <script>
        // Demo simulation state
        let isRunning = false;
        let generation = 0;
        let simulationInterval = null;
        let researcher = null;
        let candidatePool = [];
        let battleHistory = [];

        // Trait names for display
        const traitNames = ['aggression', 'speed', 'accuracy', 'defense', 'cooperation', 
                          'formation', 'flanking', 'ambush', 'riskTaking'];

        // Initialize the demo
        function initializeDemo() {
            // Create researcher instance
            researcher = new EnhancedTankResearcher();
            
            // Initialize with some candidate genomes
            for (let i = 0; i < 10; i++) {
                candidatePool.push({
                    genome: researcher.generateRandomGenome(),
                    fitness: Math.random(),
                    team: i < 5 ? 'red' : 'blue'
                });
            }

            updateDisplay();
            logMessage('DEMO', 'Simulation initialized with random population');
        }

        function startEvolution() {
            if (isRunning) return;
            
            isRunning = true;
            document.querySelector('.controls').classList.add('running');
            
            simulationInterval = setInterval(() => {
                stepEvolution();
            }, 2000); // Step every 2 seconds

            logMessage('EVOLUTION', 'Evolution simulation started');
        }

        function pauseEvolution() {
            isRunning = false;
            document.querySelector('.controls').classList.remove('running');
            
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
            }

            logMessage('EVOLUTION', 'Evolution simulation paused');
        }

        function stepEvolution() {
            generation++;
            
            // Simulate a generation step
            try {
                const cognitionBase = new MilitaryTacticsKnowledge();
                const experiment = researcher.proposeExperiment(candidatePool, battleHistory, cognitionBase);
                
                // Simulate battle results
                const battleResult = simulateBattle(experiment);
                battleHistory.push({
                    generation: generation,
                    redGenomes: experiment.redGenomes,
                    blueGenomes: experiment.blueGenomes,
                    result: battleResult
                });

                // Update candidate pool with new genomes
                updateCandidatePool(experiment, battleResult);
                
                // Notify insights system
                if (window.researcherInsights) {
                    window.researcherInsights.trackGenerationComplete(generation, battleResult);
                }

                updateDisplay();
                logMessage('GENERATION', `Generation ${generation} completed - Winner: ${battleResult.winner}`);

            } catch (error) {
                logMessage('ERROR', `Evolution step failed: ${error.message}`);
                pauseEvolution();
            }
        }

        function simulateBattle(experiment) {
            // Simple battle simulation for demo
            const redFitness = experiment.redGenomes.reduce((sum, genome) => {
                return sum + calculateGenomeFitness(genome);
            }, 0) / experiment.redGenomes.length;

            const blueFitness = experiment.blueGenomes.reduce((sum, genome) => {
                return sum + calculateGenomeFitness(genome);
            }, 0) / experiment.blueGenomes.length;

            // Add some randomness
            const redScore = redFitness + (Math.random() - 0.5) * 0.2;
            const blueScore = blueFitness + (Math.random() - 0.5) * 0.2;

            return {
                winner: redScore > blueScore ? 'red' : 'blue',
                redTeamStats: {
                    averageFitness: redFitness,
                    averageSurvivalTime: 40 + redFitness * 40,
                    accuracy: redFitness * 0.8,
                    totalDamageDealt: redFitness * 100
                },
                blueTeamStats: {
                    averageFitness: blueFitness,
                    averageSurvivalTime: 40 + blueFitness * 40,
                    accuracy: blueFitness * 0.8,
                    totalDamageDealt: blueFitness * 100
                }
            };
        }

        function calculateGenomeFitness(genome) {
            // Simple fitness calculation based on genome traits
            const aggression = genome[0];
            const speed = genome[1];
            const accuracy = genome[2];
            const defense = genome[3];
            const cooperation = genome[4];

            // Balanced fitness favoring certain combinations
            return (aggression * 0.3 + speed * 0.2 + accuracy * 0.3 + defense * 0.1 + cooperation * 0.1);
        }

        function updateCandidatePool(experiment, battleResult) {
            // Keep winners and add some mutations
            const survivors = [];
            
            // Add winners
            if (battleResult.winner === 'red') {
                experiment.redGenomes.forEach(genome => {
                    survivors.push({
                        genome: genome,
                        fitness: calculateGenomeFitness(genome) + 0.1,
                        team: 'red'
                    });
                });
                // Add some evolved blue genomes
                experiment.blueGenomes.forEach(genome => {
                    const mutated = researcher.mutate([...genome]);
                    survivors.push({
                        genome: mutated,
                        fitness: calculateGenomeFitness(mutated),
                        team: 'blue'
                    });
                });
            } else {
                experiment.blueGenomes.forEach(genome => {
                    survivors.push({
                        genome: genome,
                        fitness: calculateGenomeFitness(genome) + 0.1,
                        team: 'blue'
                    });
                });
                // Add some evolved red genomes
                experiment.redGenomes.forEach(genome => {
                    const mutated = researcher.mutate([...genome]);
                    survivors.push({
                        genome: mutated,
                        fitness: calculateGenomeFitness(mutated),
                        team: 'red'
                    });
                });
            }

            candidatePool = survivors;
        }

        function updateDisplay() {
            // Update generation counter
            document.getElementById('generation-count').textContent = generation;
            
            // Update metrics from insights
            if (window.researcherInsights) {
                const metrics = window.researcherInsights.metrics;
                document.getElementById('mutation-count').textContent = metrics.mutations;
                document.getElementById('crossover-count').textContent = metrics.crossovers;
                document.getElementById('tournament-count').textContent = metrics.tournaments;
            }

            // Update team displays
            updateTeamDisplay('red');
            updateTeamDisplay('blue');
            
            // Update evolution charts
            updateEvolutionCharts();
        }

        function updateTeamDisplay(team) {
            const teamGenomes = candidatePool.filter(c => c.team === team);
            if (teamGenomes.length === 0) return;

            // Calculate average genome
            const avgGenome = new Array(9).fill(0);
            teamGenomes.forEach(candidate => {
                candidate.genome.forEach((trait, i) => {
                    avgGenome[i] += trait;
                });
            });
            avgGenome.forEach((sum, i) => {
                avgGenome[i] = sum / teamGenomes.length;
            });

            // Update genome display
            const displayElement = document.getElementById(`${team}-genome-display`);
            displayElement.innerHTML = traitNames.map((name, i) => {
                const value = avgGenome[i];
                const percentage = (value * 100).toFixed(0);
                const colorClass = team === 'red' ? 'red-bar' : '';
                
                return `
                    <div class="trait-bar">
                        <span class="trait-name">${name}:</span>
                        <div class="trait-value">
                            <div class="trait-fill ${colorClass}" style="width: ${percentage}%"></div>
                        </div>
                        <span>${value.toFixed(2)}</span>
                    </div>
                `;
            }).join('');

            // Update strategy analysis
            const strategy = analyzeStrategy(avgGenome);
            document.getElementById(`${team}-strategy`).textContent = strategy;

            // Update fitness trend
            const fitnessTrend = calculateFitnessTrend(team);
            document.getElementById(`${team}-fitness`).textContent = fitnessTrend;

            // Update diversity
            const diversity = calculateTeamDiversity(teamGenomes);
            document.getElementById(`${team}-diversity`).textContent = diversity;
        }

        function analyzeStrategy(genome) {
            const [aggression, speed, accuracy, defense, cooperation, formation, flanking, ambush, riskTaking] = genome;
            
            if (aggression > 0.7 && speed > 0.6) return 'Aggressive Blitz';
            if (defense > 0.7 && formation > 0.6) return 'Defensive Wall';
            if (flanking > 0.6 && cooperation > 0.6) return 'Coordinated Flanking';
            if (ambush > 0.7 && riskTaking < 0.4) return 'Guerrilla Tactics';
            if (accuracy > 0.7 && speed > 0.6) return 'Mobile Sniper';
            
            return 'Balanced Approach';
        }

        function calculateFitnessTrend(team) {
            if (battleHistory.length < 3) return 'Insufficient Data';
            
            const recentBattles = battleHistory.slice(-3);
            const wins = recentBattles.filter(b => b.result.winner === team).length;
            
            if (wins >= 2) return 'Improving';
            if (wins === 1) return 'Stable';
            return 'Declining';
        }

        function calculateTeamDiversity(teamGenomes) {
            if (teamGenomes.length < 2) return 'Low';
            
            let totalDistance = 0;
            let comparisons = 0;
            
            for (let i = 0; i < teamGenomes.length; i++) {
                for (let j = i + 1; j < teamGenomes.length; j++) {
                    let distance = 0;
                    for (let k = 0; k < 9; k++) {
                        distance += Math.pow(teamGenomes[i].genome[k] - teamGenomes[j].genome[k], 2);
                    }
                    totalDistance += Math.sqrt(distance);
                    comparisons++;
                }
            }
            
            const avgDistance = totalDistance / comparisons;
            
            if (avgDistance > 0.5) return 'High';
            if (avgDistance > 0.2) return 'Medium';
            return 'Low';
        }

        function updateEvolutionCharts() {
            // Simple chart visualization
            if (battleHistory.length === 0) return;
            
            const recentHistory = battleHistory.slice(-10);
            
            // Aggression evolution chart
            const aggressionChart = document.getElementById('aggression-chart');
            aggressionChart.innerHTML = recentHistory.map((battle, i) => {
                const redAggr = battle.redGenomes.reduce((sum, g) => sum + g[0], 0) / battle.redGenomes.length;
                const blueAggr = battle.blueGenomes.reduce((sum, g) => sum + g[0], 0) / battle.blueGenomes.length;
                
                return `
                    <div class="evolution-bar red-bar" style="height: ${redAggr * 60}px" title="Red: ${redAggr.toFixed(2)}"></div>
                    <div class="evolution-bar" style="height: ${blueAggr * 60}px" title="Blue: ${blueAggr.toFixed(2)}"></div>
                `;
            }).join('');
            
            // Tactical sophistication chart
            const tacticsChart = document.getElementById('tactics-chart');
            tacticsChart.innerHTML = recentHistory.map((battle, i) => {
                const redTactics = battle.redGenomes.reduce((sum, g) => sum + (g[4] + g[5] + g[6]) / 3, 0) / battle.redGenomes.length;
                const blueTactics = battle.blueGenomes.reduce((sum, g) => sum + (g[4] + g[5] + g[6]) / 3, 0) / battle.blueGenomes.length;
                
                return `
                    <div class="evolution-bar red-bar" style="height: ${redTactics * 60}px" title="Red: ${redTactics.toFixed(2)}"></div>
                    <div class="evolution-bar" style="height: ${blueTactics * 60}px" title="Blue: ${blueTactics.toFixed(2)}"></div>
                `;
            }).join('');
        }

        function resetSimulation() {
            pauseEvolution();
            generation = 0;
            candidatePool = [];
            battleHistory = [];
            
            if (window.researcherInsights) {
                window.researcherInsights.logs = [];
                window.researcherInsights.generationData = [];
                window.researcherInsights.metrics = {
                    genomeGenerations: 0,
                    mutations: 0,
                    crossovers: 0,
                    tournaments: 0,
                    experiments: 0,
                    redQueenAdaptations: 0
                };
            }
            
            initializeDemo();
            logMessage('SYSTEM', 'Simulation reset to initial state');
        }

        function generateReport() {
            if (window.researcherInsights) {
                const report = window.researcherInsights.generateReport();
                logMessage('REPORT', `Generated comprehensive analysis report`);
                console.log('Researcher Insights Report:', report);
                
                // Show summary in alert
                alert(`üî¨ Researcher Analysis Report Generated!\n\nGenerations: ${report.summary.totalGenerations}\nMutations: ${report.summary.totalMetrics.mutations}\nCrossovers: ${report.summary.totalMetrics.crossovers}\nAdaptations: ${report.summary.totalMetrics.redQueenAdaptations}\n\nCheck browser console for detailed report.`);
            }
        }

        function exportData() {
            if (window.researcherInsights) {
                window.researcherInsights.exportMetrics();
                window.researcherInsights.exportLogs();
                logMessage('EXPORT', 'Evolution data exported to files');
            }
        }

        function logMessage(category, message) {
            const logArea = document.getElementById('demo-logs');
            const timestamp = new Date().toLocaleTimeString();
            
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="log-category">[${category}]</span> ${timestamp}: ${message}`;
            
            logArea.appendChild(logEntry);
            logArea.scrollTop = logArea.scrollHeight;
            
            // Keep only last 50 logs
            while (logArea.children.length > 50) {
                logArea.removeChild(logArea.firstChild);
            }
        }

        // Initialize demo when page loads
        window.addEventListener('load', () => {
            initializeDemo();
            logMessage('SYSTEM', 'Researcher Insights Demo ready for exploration');
        });
    </script>
</body>
</html>
