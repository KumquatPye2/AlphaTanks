<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Refactored Components Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .test-section {
            margin-bottom: 30px;
        }
        
        .test-button {
            background: #007acc;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .test-button:hover {
            background: #005c99;
        }
        
        .test-button.success {
            background: #28a745;
        }
        
        .test-button.error {
            background: #dc3545;
        }
        
        .console-output {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .status {
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .status.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .architecture-diagram {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 20px;
            border-radius: 4px;
            font-family: monospace;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 AlphaTanks Refactored Components Test</h1>
        <p>This page tests the refactored components to ensure they work correctly together.</p>
        
        <div class="test-section">
            <h2>Component Tests</h2>
            <button class="test-button" onclick="runBasicTests()">Run Basic Tests</button>
            <button class="test-button" onclick="runIntegrationDemo()">Run Integration Demo</button>
            <button class="test-button" onclick="clearConsole()">Clear Console</button>
            <div id="test-status"></div>
            <div id="console-output" class="console-output"></div>
        </div>
        
        <div class="test-section">
            <h2>Architecture Overview</h2>
            <div class="architecture-diagram">
Refactored Architecture:

refactored/
├── common/
│   ├── constants.js     - GAME_CONFIG, centralized settings
│   └── utils.js         - MathUtils, GenomeUtils, CollisionUtils, etc.
├── ai/
│   ├── tank-entity.js   - Core tank data (health, position, stats)
│   ├── tank-ai.js       - AI behavior system (patrol, attack, retreat)
│   ├── tank-combat.js   - Combat system (firing, projectiles, damage)
│   └── tank.js          - Composed tank (backward compatible)
├── game/
│   ├── battle-managers.js - BattlefieldManager, CombatManager, BattleStatsManager
│   └── game-engine.js     - Main game orchestration (composition pattern)
└── integration-test.js    - Testing and demo utilities

Benefits:
✅ Reduced complexity (Tank: 1402→316 lines, GameEngine: 686→320 lines)
✅ Eliminated code duplication (centralized utilities)
✅ Improved maintainability (single responsibility principle)
✅ Better testability (focused components)
✅ Backward compatibility maintained
            </div>
        </div>
        
        <div class="test-section">
            <h2>Component Status</h2>
            <div id="component-status">
                <p>Loading components...</p>
            </div>
        </div>
    </div>

    <!-- Load refactored components -->
    <script src="common/constants.js"></script>
    <script src="common/utils.js"></script>
    <script src="ai/tank-entity.js"></script>
    <script src="ai/tank-ai.js"></script>
    <script src="ai/tank-combat.js"></script>
    <script src="ai/tank.js"></script>
    <script src="game/hill-control.js"></script>
    <script src="game/battle-managers.js"></script>
    <script src="integration-test.js"></script>

    <script>
        // Console capture for display
        const originalConsole = {
            log: console.log,
            error: console.error,
            assert: console.assert
        };
        
        let consoleOutput = '';
        
        function captureConsole() {
            console.log = function(...args) {
                const message = args.map(arg => 
                    typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                ).join(' ');
                consoleOutput += message + '\n';
                originalConsole.log(...args);
                updateConsoleDisplay();
            };
            
            console.error = function(...args) {
                const message = 'ERROR: ' + args.map(arg => 
                    typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
                ).join(' ');
                consoleOutput += message + '\n';
                originalConsole.error(...args);
                updateConsoleDisplay();
            };
            
            console.assert = function(condition, ...args) {
                if (!condition) {
                    const message = 'ASSERTION FAILED: ' + args.join(' ');
                    consoleOutput += message + '\n';
                    updateConsoleDisplay();
                }
                originalConsole.assert(condition, ...args);
            };
        }
        
        function updateConsoleDisplay() {
            document.getElementById('console-output').textContent = consoleOutput;
            const element = document.getElementById('console-output');
            element.scrollTop = element.scrollHeight;
        }
        
        function clearConsole() {
            consoleOutput = '';
            updateConsoleDisplay();
        }
        
        function showStatus(message, isSuccess = true) {
            const statusDiv = document.getElementById('test-status');
            statusDiv.innerHTML = `<div class="status ${isSuccess ? 'success' : 'error'}">${message}</div>`;
        }
        
        async function runBasicTests() {
            clearConsole();
            showStatus('Running basic component tests...', true);
            
            try {
                const success = testRefactoredComponents();
                if (success) {
                    showStatus('✅ All basic tests passed!', true);
                } else {
                    showStatus('❌ Some tests failed. Check console for details.', false);
                }
            } catch (error) {
                showStatus(`❌ Test error: ${error.message}`, false);
                console.error('Test execution error:', error);
            }
        }
        
        async function runIntegrationDemo() {
            clearConsole();
            showStatus('Running integration demonstration...', true);
            
            try {
                demonstrateRefactoredUsage();
                showStatus('✅ Integration demo completed successfully!', true);
            } catch (error) {
                showStatus(`❌ Demo error: ${error.message}`, false);
                console.error('Demo execution error:', error);
            }
        }
        
        function checkComponentAvailability() {
            const components = [
                { name: 'GAME_CONFIG', check: () => typeof GAME_CONFIG !== 'undefined' },
                { name: 'MathUtils', check: () => typeof MathUtils !== 'undefined' },
                { name: 'GenomeUtils', check: () => typeof GenomeUtils !== 'undefined' },
                { name: 'TankEntity', check: () => typeof TankEntity !== 'undefined' },
                { name: 'TankAI', check: () => typeof TankAI !== 'undefined' },
                { name: 'TankCombat', check: () => typeof TankCombat !== 'undefined' },
                { name: 'Tank', check: () => typeof Tank !== 'undefined' },
                { name: 'Hill', check: () => typeof Hill !== 'undefined' },
                { name: 'BattlefieldManager', check: () => typeof BattlefieldManager !== 'undefined' },
                { name: 'CombatManager', check: () => typeof CombatManager !== 'undefined' },
                { name: 'BattleStatsManager', check: () => typeof BattleStatsManager !== 'undefined' }
            ];
            
            const statusDiv = document.getElementById('component-status');
            let statusHTML = '<h3>Component Availability:</h3><ul>';
            
            components.forEach(component => {
                const isAvailable = component.check();
                statusHTML += `<li style="color: ${isAvailable ? 'green' : 'red'}">
                    ${isAvailable ? '✅' : '❌'} ${component.name}
                </li>`;
            });
            
            statusHTML += '</ul>';
            statusDiv.innerHTML = statusHTML;
            
            const allAvailable = components.every(c => c.check());
            if (allAvailable) {
                statusHTML += '<p style="color: green; font-weight: bold;">🎉 All components loaded successfully!</p>';
            } else {
                statusHTML += '<p style="color: red; font-weight: bold;">⚠️ Some components failed to load. Check file paths.</p>';
            }
            
            statusDiv.innerHTML = statusHTML;
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            captureConsole();
            
            // Delay component check to allow all scripts to load
            setTimeout(() => {
                checkComponentAvailability();
            }, 100);
            
            console.log('🔧 Refactored Components Test Page Loaded');
            console.log('Click the buttons above to run tests and demonstrations.');
        });
    </script>
</body>
</html>
